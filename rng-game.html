<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>RNG Clicker (TV Safe)</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f0;
      color: #222;
      text-align: center;
    }
    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
    }
    #log {
      white-space: pre-line;
      background: #fff;
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      border: 1px solid #ccc;
      margin: 10px;
    }
  </style>
</head>
<body>
  <h1>RNG Clicker (TV Safe Version)</h1>
  <button onclick="roll()">🎲 Quay</button>
  <button onclick="toggleAutoRoll()">⚙️ Auto Roll: <span id="autoRollState">Tắt</span></button>
  <button onclick="showInventory()">🎒 Kho đồ</button>
  <button onclick="clearInventory()">🗑️ Xoá kho</button>
  <div id="stats"></div>
  <div id="log"></div>

  <script>
    let rollCount = 0;
    let inventory = {};
    let autoRoll = false;
    let luck = 0;
    let rollSpeed = 3000;
    const MIN_DELAY = 1000;

    const drops = [
      { name: "Gỗ", chance: 0.5 },
      { name: "Đá", chance: 0.3 },
      { name: "Sắt", chance: 0.15 },
      { name: "Pha lê", chance: 0.05 },
      { name: "Đá quý", chance: 0.002 }
    ];

    const crafts = {
      "Nhẫn may mắn": {
        cost: { "Pha lê": 2, "Đá quý": 1 },
        effect: () => {
          luck += 5;
          logMessage("🍀 May mắn tăng lên +5!");
        }
      },
      "Giày gió": {
        cost: { "Sắt": 3, "Pha lê": 1 },
        effect: () => {
          if (rollSpeed <= MIN_DELAY) {
            logMessage("⛔ Không thể craft thêm! Bạn đã đạt đến giới hạn tốc độ quay (1000ms).");
          } else {
            rollSpeed -= 100;
            if (rollSpeed < MIN_DELAY) rollSpeed = MIN_DELAY;
            if (rollSpeed === MIN_DELAY) {
              logMessage("⛔ Bạn đã đạt đến tối thiểu Speed/Delay!");
            } else {
              logMessage("✅ Tốc độ quay được cải thiện!");
            }
          }
        }
      }
    };

    function roll() {
      rollCount++;
      const drop = getDrop();
      inventory[drop] = (inventory[drop] || 0) + 1;
      logMessage(`🎉 Bạn nhận được: ${drop}`);
      updateStats();
      checkAchievements();
    }

    function getDrop() {
      const roll = Math.random() * (1 + luck / 100);
      let sum = 0;
      for (let item of drops) {
        sum += item.chance;
        if (roll <= sum) return item.name;
      }
      return drops[0].name;
    }

    function logMessage(msg) {
      const log = document.getElementById("log");
      log.textContent += msg + "\n";
      log.scrollTop = log.scrollHeight;
    }

    function updateStats() {
      document.getElementById("stats").textContent =
        `🔁 Rolls: ${rollCount} | 🍀 Luck: ${luck} | ⏱️ Speed: ${rollSpeed}ms`;
    }

    function toggleAutoRoll() {
      autoRoll = !autoRoll;
      document.getElementById("autoRollState").textContent = autoRoll ? "Bật" : "Tắt";
      if (autoRoll) autoRollLoop();
    }

    function autoRollLoop() {
      if (!autoRoll) return;
      roll();
      setTimeout(autoRollLoop, rollSpeed);
    }

    function showInventory() {
      let inv = "🎒 Kho đồ:\n";
      for (let item in inventory) {
        if (!item.startsWith("__")) {
          inv += `${item}: ${inventory[item]}\n`;
        }
      }
      inv += "\n🛠️ Craft đồ:\n";
      for (let item in crafts) {
        const canCraft = Object.entries(crafts[item].cost).every(
          ([mat, qty]) => (inventory[mat] || 0) >= qty
        );
        if (canCraft) {
          inv += `👉 ${item} - Nhấn OK để craft\n`;
        } else {
          inv += `❌ ${item} - Thiếu nguyên liệu\n`;
        }
      }
      alert(inv);
      for (let item in crafts) {
        const canCraft = Object.entries(crafts[item].cost).every(
          ([mat, qty]) => (inventory[mat] || 0) >= qty
        );
        if (canCraft) {
          crafts[item].effect();
          for (let [mat, qty] of Object.entries(crafts[item].cost)) {
            inventory[mat] -= qty;
          }
        }
      }
      updateStats();
    }

    function clearInventory() {
      inventory = {};
      logMessage("📦 Kho đã được xoá!");
      updateStats();
    }

    function checkAchievements() {
      if (rollCount >= 100 && !inventory.__ach100) {
        inventory.__ach100 = true;
        logMessage("🏆 Thành tựu: Quay 100 lần!");
      }
      if (rollSpeed <= 1000 && !inventory.__fast) {
        inventory.__fast = true;
        logMessage("🏆 Thành tựu: Speed dưới 1000ms!");
      }
    }

    updateStats();
  </script>
</body>
</html>
